deploy:
  runs-on: self-hosted
  needs: build-and-push

  steps:
    # Step 1: Notify Google Chat - Deployment Started
    - name: Notify Google Chat - Deployment Started
      run: |
        curl -X POST -H "Content-Type: application/json" \
        -d '{"text": "üöÄ Docker Deployment started for *sampledocker*"}' \
        "${{ secrets.GOOGLE_CHAT_WEBHOOK }}"

    # Step 2: Pull the latest image
    - name: Pull latest Docker image
      run: docker pull jeevanjames2000/sampledocker:latest

    # Step 3: Stop and remove the existing container
    - name: Stop and remove existing container
      run: |
        docker stop sampledocker || true
        docker rm sampledocker || true

    # Step 4: Run the updated container
    - name: Run updated container
      run: docker run -d -p 7000:7000 --name sampledocker jeevanjames2000/sampledocker:latest

    # Step 5: Notify Google Chat - Deployment Successful
    - name: Notify Google Chat - Deployment Successful
      if: success()
      run: |
        curl -X POST -H "Content-Type: application/json" \
        -d '{"text": "‚úÖ *sampledocker* deployed successfully!"}' \
        "${{ secrets.GOOGLE_CHAT_WEBHOOK }}"

    # Step 6: Notify Google Chat - Deployment Failed
    - name: Notify Google Chat - Deployment Failed
      if: failure()
      run: |
        curl -X POST -H "Content-Type: application/json" \
        -d '{"text": "‚ùå *sampledocker* deployment failed!"}' \
        "${{ secrets.GOOGLE_CHAT_WEBHOOK }}"
